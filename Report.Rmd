---
title: "Report"
author: "FÃ¡bio Teixeira, Miguel Ferreira, Vanessa Silva"
date: "20 de Dezembro de 2016"
output: html_document
---

#First task:

##Data import and clean-up

###Setting the *working directory*

Download the file "crime.xls" to the directory where you are going to work. Alternatively, if you want to change the current directory, do:

```{r, eval=FALSE}
setwd(dir)
```

And to view the current directory:

```{r}
getwd()
```

###Import the data into an appropriate R format:

Note: If you do not have Perl installed on Windows, download it [here](http://www.activestate.com/activeperl/downloads).

```{r, message=FALSE, warning=FALSE, results='hide'}
#Install the necessary packages
install.packages("gdata")
install.packages("lubridate")
install.packages("xts")
install.packages("dplyr")
install.packages("DMwR")

#Load the packages
library(gdata)
library(lubridate)
library(xts)
library(dplyr)
library(stringr)
library(DMwR)
library(class)

perldir <- Sys.which("perl")

fc <- "crime.xls" 
dat <- read.xls(fc, sheet = 1, header = TRUE, verbose=FALSE, perl=perldir, na.strings = "UNK")
dat$BlockRange <- as.character(dat$BlockRange)
dat$StreetName <- as.character(dat$StreetName)
dat$Type <- as.character(dat$Type)
dat$Suffix <- as.character(dat$Suffix)
```

###Check whether any data clean-up and/or pre-processing steps are necessary.
The Offense Types found on the data set are:
```{r}
unique(dat$Offense.Type)
dat[dat$Offense.Type == 1,]
```
We identified an instance where the `Offense.Type` column does not have a valid value. However, it is a registered crime that quite possibly happened, and although it may not help predicting which crimes may occur, it will surely help predicting how many crimes per beat will occur.

All dates have a valid format:
```{r}
dat[!grep("^[0-9]{4}-[0-9]{2}-[0-9]{2}$", dat$Date),]
```

All hours have a valid format:
```{r}
dat[dat$Hour < 0 | dat$Hour > 23,]
dat[!grep("^[0-9]{2}$", dat$Hour),]
```
Some anomalies were found on the `Beat` column:
```{r}
unique(dat$Beat)
nrow(dat[is.na(dat$Beat),])
```

The `Beat` column is rather important since the purpose of the prediction model is given a beat and a time of the day, predict how many crimes will occur. Luckily, there are not many invalid `Beat` cells.

Based on Hounton Police [beat map][http://www.houstontx.gov/police/pdfs/hpd_beat_map.pdf] we can reconstruct manually the `Beat` cells using the street name and block range.

However, using Google Maps API and Data Science Toolkit providers for the package `ggmap` we were able to obtain GPS coordinates for the locations of each crime. This allows us to reconstruct the `Beat` column using the k-nearest neighbours of the coordinates column.

```{r}
load("gps.RData")
incomplete <- is.na(dat$Beat)
tr <- gps[!incomplete,1:2]
ts <- gps[incomplete,1:2]
dat$Beat[incomplete] <- knn(tr, ts, dat$Beat[!incomplete], k = 3)
```

```{r}
nrow(dat[is.na(dat$BlockRange),])
```
```{r}
unique(dat$Type)
nrow(dat[dat$Type == "-",])
```

```{r}
unique(dat$Suffix)
nrow(dat[dat$Suffix == "-",])
```

```{r}
unique(dat$X..offenses)
```

#Second task:

##Data exploratory analysis
Summarize and visualize the data in ways that we find useful for the police (look for interesting questions the police may have about the data and provide the answers, or use textual summaries or data visualization).

```{r}

```

#Third task:

##Predictive modeling
###Set a prediction task that can help police respond to their operational objective. 

```{r}
```

###Use the available data to select and get a good model for this task.

```{r}

```

###Give a justification for the suggested model.
