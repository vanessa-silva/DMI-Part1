---
title: "Report"
author: "FÃ¡bio Teixeira, Miguel Ferreira, Vanessa Silva"
date: "20 de Dezembro de 2016"
output: html_document
---

#First task:

##Data import and clean-up

###Setting the working directory

Download the file "crime.xls" to the directory where you are going to work. Alternatively, if you want to change the current directory, do:

```{r, eval=FALSE}
setwd(dir)
```

And to view the current directory:

```{r}
getwd()
```

###Import the data into an appropriate R format:

Note: If you do not have Perl installed on Windows, download it [here](http://www.activestate.com/activeperl/downloads).

```{r, message=FALSE, warning=FALSE, results='hide'}
#Install the necessary packages
install.packages("gdata")
install.packages("lubridate")
install.packages("xts")
install.packages("dplyr")

#Load the packages
library(gdata)
library(lubridate)
library(xts)
library(dplyr)
library(stringr)

perldir <- Sys.which("perl")

fc <- "crime.xls" 
dat <- read.xls(fc, sheet = 1, header = TRUE, verbose=FALSE, perl=perldir, na.strings = "UNK")
```

###Check whether any data clean-up and/or pre-processing steps are necessary.
The Offense Types found on the data set are:
```{r}
unique(dat$Offense.Type)
dat[dat$Offense.Type == 1,]
```
We identified an instance where the `Offense.Type` column does not have a valid value.
Thus we perform a "cleaning" of the same.
```{r}
#dat_clean <- dat[-(dat$Offense.Type == 1), ]
dat <- subset(dat, dat$Offense.Type != 1)
```

All dates have a valid format:
```{r}
dat[!grep("^[0-9]{4}-[0-9]{2}-[0-9]{2}$", dat$Date),]
```

All hours have a valid format:
```{r}
dat[dat$Hour < 0 | dat$Hour > 23,]
dat[!grep("^[0-9]{2}$", dat$Hour),]
```
Some anomalies (unknown values) were found on the `Beat` column:
```{r}
unique(dat$Beat)
nrow(dat[is.na(dat$Beat),])
```
Some anomalies (unknown values) were found on the `BlockRange` column:
```{r}
nrow(dat[is.na(dat$BlockRange),])
```
Some anomalies (worthless) were found on the `Type` column:
```{r}
unique(dat$Type)
nrow(dat[dat$Type == "-",])
```
Some anomalies (worthless) were found on the `Suffix` column:
```{r}
unique(dat$Suffix)
nrow(dat[dat$Suffix == "-",])
```
All offenses were counted:
```{r}
unique(dat$X..offenses)
```

For each anomaly detected we have 3 options:

- Remove lines containing invalid data.
- Substitute invalid cells by a central measure of the cell.
- Substitute invalid cells by an average over the k-nearest neighbours of its line on the data set.

#Second task:

##Data exploratory analysis
Summarize and visualize the data in ways that we find useful for the police (look for interesting questions the police may have about the data and provide the answers, or use textual summaries or data visualization).

```{r}
dat <- tbl_df(dat)

#View the data per hour
datxts <- xts(dat, ymd_h(paste(dat$Date,' ',dat$Hour)))

#Split the data into 3 categories
i1 <- filter(dat, 8 <= dat$Hour, dat$Hour < 12)
i2 <- filter(dat, 12 <= dat$Hour, dat$Hour < 19)
i3 <- filter(dat, (19 <= dat$Hour & dat$Hour <= 23) | (0 <= dat$Hour & dat$Hour < 8))

#How many Offenses are made per interval in each category
sum1 <- group_by(i1, Beat) %>% summarise(num=sum(X..offenses))
sum2 <- group_by(i2, Beat) %>% summarise(num=sum(X..offenses))
sum3 <- group_by(i3, Beat) %>% summarise(num=sum(X..offenses))

#How many offenses are made per offense type
sum4 <- group_by(dat, Offense.Type) %>% summarise(num=sum(X..offenses))
plot(sum4$num ~ sum4$Offense.Type, xlab = "Offense.Type", ylab = "Num", main = "Number of offenses per offense type")

#How many offenses are made per offense type in each beat
sum5 <- group_by(dat, Offense.Type, Beat) %>% summarise(num=sum(X..offenses))
```
Some data summarization:
```{r}
dat %>% summarise(avg.Off=mean(dat$X..offenses),
                  cen.OffTp=centralValue(dat$Offense.Type),
                  cen.StrNm=centralValue(dat$StreetName))
```

#Third task:

##Predictive modeling
###Set a prediction task that can help police respond to their operational objective. 

```{r}

```

###Use the available data to select and get a good model for this task.

```{r}

```

###Give a justification for the suggested model.
